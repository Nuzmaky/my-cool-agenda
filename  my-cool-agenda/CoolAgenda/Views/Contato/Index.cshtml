@model CoolAgenda.ViewModels.ContatoVM
@{
    ViewBag.Title = "Contato";
}
<div id="paginas" style="width:97%; margin-left:auto;margin-right:auto;">

    <a href="@Url.Action("Form")">Novo</a>

    <h2>Contato</h2>
    @{
        if (Model.TotalRegistros > 0)
        {
        
        <table>
            <tr>
                <th>Nome</th>
                <th>Email</th>
                <th>Telefone</th>
                <th>Endereço</th>
            </tr>

        @{ int k=0;
           
            for (int i = 0; i < Model.ListaContato.Count; i++)
            {
                int c = 0;
                <tr>
                    <td>@Model.ListaContato[i].Nome</td>                
                    <td>@Model.ListaContato[i].Email</td> 

                    <td>
                        @if (Model.ListaTelefone != null && Model.ListaTelefone.Count != 0)
                        {                     
                            <ul style="list-style-type:none">           
                                @{                                    
                                    while (k < Model.ListaTelefone.Count && Model.ListaTelefone[k].IdContato < Model.ListaContato[i].IdContato)
                                        { 
                                           k++;
                                        }
                                        
                                        {                                        
                                            while (k < Model.ListaTelefone.Count && Model.ListaTelefone[k].IdContato == Model.ListaContato[i].IdContato)
                                            {
                                                <li>@Model.ListaTelefone[k].NumeroTelefone</li>
                                                if (c == 1) 
                                                {                                                     
                                                    {k++; break; }
                                                }
                                                else { c++; k++; }
                                            }                            
                                        }
                                }                                    
                             </ul>  
                        }
                         </td>                                                                    
                    <td>@Model.ListaContato[i].Endereco</td>

                <td class="opcoes2">
                    <img class="no-border" src="../Images/editar.png" />@Html.ActionLink("Editar", "Form", new { id = Model.ListaContato[i].IdContato})                    
                        @if (Model.ListaContato[i].Ativo.Equals("S"))
                        {
                            <img class="no-border" src="../Images/desativar.png" /><a href="#" onclick="DesativarRegistro(@Model.ListaContato[i].IdContato);"> Excluir</a>
                        }
    

                    <img class="no-border" src="../Images/Novo.png" />@Html.ActionLink("Convidar", "Convida", new { id = Model.ListaContato[i].IdContato})
                </td>
            </tr>
        }
        }
        </table>
        
        }
        else
        {
        <p>Não existe nenhum registro cadastrado.</p>
        }       
   }    
</div>

@section scripts 
{
    <script type="text/javascript">

        // Armazena o id/codigo do registro a ser ativado/desativado
        var idRegistro;

        // Trata o evento onclick da opção de desativar um registro
        function DesativarRegistro(id) {            
            idRegistro = id;
            RequisitaDesativacaoRegServidor();                        
        }


        // Efetua uma requisição ao servidor pedindo para desativar um registro
        function RequisitaDesativacaoRegServidor() {            
            $.post('@Url.Action("Desativar")', { id: idRegistro }, function (data) {                                
                // Mostra uma notificação de acordo com a resposta do servidor                
                if (!data.Erro)                    
                    JSMostraNotificacaoSucesso(data.Mensagem, false, function () { location.reload(); });
            else                
                   JSMostraNotificacaoErro(data.Mensagem, true);
            });
        }


    </script>
        
    }
        

        
    